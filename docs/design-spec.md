# デザイン仕様書

Office-layout レイアウトエンジンの設計仕様をまとめたドキュメントです。

---

## 1. 座標系と単位

### 1.1 単位

- 全ての寸法は **ミリメートル (mm)** で扱う
- 内部計算では整数値を使用

### 1.2 座標系

```
(0,0) ────────────────→ X (幅方向)
  │
  │   ┌─────────────┐
  │   │             │
  │   │   部屋      │
  │   │             │
  │   └─────────────┘
  ↓
  Y (奥行方向)
```

- 原点 (0, 0) は左上
- X軸: 右方向が正
- Y軸: 下方向が正
- 壁の位置:
  - T (Top): y = 0
  - B (Bottom): y = room_d
  - L (Left): x = 0
  - R (Right): x = room_w

---

## 2. 家具サイズ定義

### 2.1 デスク (席ユニット)

| タイプ | 幅 (w) | 奥行 (d) | ユニット奥行 | 備考 |
|--------|--------|----------|--------------|------|
| ws_1200x700 | 1200mm | 700mm | 1300mm | 大型デスク |
| ws_1200x600 | 1200mm | 600mm | 1200mm | 標準デスク |
| ws_1000x600 | 1000mm | 600mm | 1200mm | コンパクト |

**ユニット奥行の計算:**
```
ユニット奥行 = デスク奥行 + 椅子引きしろ (600mm)
```

### 2.2 椅子

| 項目 | 値 |
|------|-----|
| サイズ | 700mm x 700mm |
| デスクとの間隔 | 5mm |

### 2.3 収納

| タイプ | 幅 | 奥行 | 前方確保 |
|--------|-----|------|----------|
| storage_S | 900mm | 350mm | 600mm |
| storage_M | 900mm | 450mm | 600mm |
| storage_D | 900mm | 600mm | 600mm |

### 2.4 その他設備

| タイプ | 幅 | 奥行 | 前方確保 |
|--------|-----|------|----------|
| mfp (複合機) | 600mm | 650mm | 900mm |
| meet2p (2人打合せ) | 750mm | 750mm | 600mm |

---

## 3. レイアウトパターン

### 3.1 Plan A: 壁付け配置

デスクを壁に沿って配置するパターン。

**配置パターン:**
- 両壁配置 (左右): `place_workstations_double_wall()`
- 両壁配置 (上下): `place_workstations_double_wall_top_bottom()`
- 片壁配置: `place_workstations_single_wall()`

**特徴:**
- 席数を最大化できる
- 通路確保が容易
- プライバシーが低い

### 3.2 Plan B: 対面配置

デスクを向かい合わせに配置するパターン。

**配置ロジック:** `place_workstations_face_to_face_center()`

```
      ┌───┐ ┌───┐ ┌───┐
      │   │ │   │ │   │  ← 椅子
      └───┘ └───┘ └───┘
     ┌─────────────────┐
     │     デスク      │
     └─────────────────┘
     ┌─────────────────┐
     │     デスク      │
     └─────────────────┘
      ┌───┐ ┌───┐ ┌───┐
      │   │ │   │ │   │  ← 椅子
      └───┘ └───┘ └───┘
```

**特徴:**
- コミュニケーション促進
- 中央に配置 (center_line)
- 椅子スペース確保が必要

### 3.3 Plan C: 混在パターン (壁面+対面)

壁沿いと対面を組み合わせるパターン。

**配置ロジック:** `place_workstations_mixed()`

**パラメータ:**
- `wall_seats`: 壁沿いに配置する席数
- `wall_side`: 壁沿い配置を行う壁 (L/R/T/B)

---

## 4. 配置制約

### 4.1 ドアクリアランス

- ドア先端から **900mm** のクリアランスを確保
- 対面配置では **200mm** に緩和 (ドア回避ロジックで対応)
- ドアと反対側の壁への配置は **クリアランスチェック不要**

### 4.2 柱・障害物回避

- `can_place()` 関数で衝突判定
- 机と椅子の両方が柱と重ならないことを確認
- `can_place_desk_chair()` で事前チェック

### 4.3 椅子スペース確保

対面配置での y0 (配置開始位置) の制約:

```python
chair_space = CHAIR_SIZE + CHAIR_DESK_GAP  # 705mm
y0_min = chair_space
y0_max = room_d - unit_d_y - chair_space
```

---

## 5. 収納配置ロジック

### 5.1 壁優先順序

1. ドアと反対側の壁を優先
2. デスクがない壁を優先
3. 長辺の壁を優先

```python
# 壁優先順序: L → R → T → B (ドア側を最後に)
all_walls = ["L", "R", "T", "B"]
if door_side in all_walls:
    all_walls.remove(door_side)
    all_walls.append(door_side)
```

### 5.2 配置方向

- 壁に長辺を沿わせて配置
- L/R壁: 縦向き (w=奥行, d=幅)
- T/B壁: 横向き (w=幅, d=奥行)

---

## 6. スコアリング

### 6.1 評価項目

| 項目 | 説明 |
|------|------|
| seats_placed | 配置できた席数 |
| equipment_placed | 配置できた設備数 |
| desk_area | デスク面積 |
| ok | 要件を満たしたか |

### 6.2 優先度設定

| 優先度 | スコア順序 |
|--------|-----------|
| desk | (ok, seats, desk_area, equipment) |
| desk_1200 | (ok, seats, equipment, desk_area) |
| equipment | (ok, seats, equipment, desk_area) |

---

## 7. 出力形式

### 7.1 JSON形式

```json
{
  "meta": {
    "exported_at": "2026-02-02T21:19:05",
    "unit": "mm",
    "room_w": 6010,
    "room_d": 4010
  },
  "pages": [
    {
      "title": "Plan A (Wall)",
      "items": [
        {
          "type": "desk",
          "label": "WS1_D",
          "x": 0,
          "y": 0,
          "w": 1000,
          "d": 600
        }
      ]
    }
  ]
}
```

### 7.2 アイテムタイプ

| type | 説明 |
|------|------|
| desk | デスク |
| chair | 椅子 |
| storage_S/M/D | 収納 |
| mfp | 複合機 |
| door_arc | ドア (円弧表示) |
| block | 柱・障害物 |
| window | 窓 |
| dim_v | 垂直寸法線 |
| dim_h | 水平寸法線 |

---

## 8. 定数一覧

`constants.py` で定義:

| 定数名 | 値 | 説明 |
|--------|-----|------|
| CHAIR_SIZE | 700 | 椅子サイズ (mm) |
| CHAIR_DESK_GAP | 5 | 机椅子間隔 (mm) |
| DEFAULT_DESK_DEPTH | 600 | デフォルト机奥行 (mm) |
| DOOR_CLEAR_RADIUS | 900 | ドアクリアランス (mm) |
| MIN_PASSAGE_WIDTH | 900 | 最小通路幅 (mm) |
| DESK_SIDE_CLEARANCE | 100 | デスク側面クリアランス (mm) |
| EQUIPMENT_CLEARANCE | 100 | 設備クリアランス (mm) |

---

## 9. 部屋サイズ制限

| 項目 | 最小値 | 最大値 |
|------|--------|--------|
| 幅 (room_w) | 2000mm | 50000mm |
| 奥行 (room_d) | 2000mm | 50000mm |

PDF出力スケール:
- 1:20, 1:30, 1:50, 1:100 を自動選択
- 最大 1:100 まで対応

---

## 10. 窓の定義

### 10.1 データ形式

```python
{
    "type": "window",
    "side": "T",        # 壁位置 (T/B/L/R)
    "offset": 500,      # 壁沿いのオフセット (mm)
    "width": 1000,      # 窓の幅 (mm)
}
```

### 10.2 描画

- PDF: 二重線で表現
- SVG: 青色の二重線で表現

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2026-02-02 | 初版作成 |
